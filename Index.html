<!DOCTYPE html>
<html lang="ar" dir="rtl" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portarage Oil - Ø­Ø§Ø³Ø¨Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø²ÙŠÙˆØª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .floating-oil {
            animation: float 6s ease-in-out infinite;
        }
        
        .gold-gradient {
            background: linear-gradient(135deg, #FFD700, #FFA500, #FFD700);
            background-size: 200% 200%;
            animation: shimmer 3s linear infinite;
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .oil-drop {
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            position: absolute;
            animation: float 4s ease-in-out infinite;
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .oil-drop:hover {
            transform: rotate(-45deg) scale(1.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        
        .oil-drop.dragging {
            cursor: grabbing;
            z-index: 1000;
            animation: none;
            transform: rotate(-45deg) scale(1.3);
            box-shadow: 0 0 30px rgba(255, 215, 0, 1);
        }
        
        .filter-icon {
            font-size: 30px;
            position: absolute;
            animation: float 5s ease-in-out infinite;
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .filter-icon:hover {
            transform: scale(1.2);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        
        .filter-icon.dragging {
            cursor: grabbing;
            z-index: 1000;
            animation: none;
            transform: scale(1.4);
            text-shadow: 0 0 30px rgba(255, 215, 0, 1);
        }
        
        .bouncing {
            animation: bounce 0.6s ease-out;
        }
        
        @keyframes bounce {
            0% { transform: scale(1.5); }
            50% { transform: scale(0.8); }
            100% { transform: scale(1); }
        }
        
        .btn-gold {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }
        
        .input-gold {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 215, 0, 0.5);
            color: #FFD700;
            transition: all 0.3s ease;
        }
        
        .input-gold:focus {
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            outline: none;
        }
    </style>
</head>
<body class="h-full bg-black text-white overflow-x-hidden">
    <!-- Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© -->
    <div class="fixed inset-0 z-0">
        <!-- Ù‚Ø·Ø±Ø§Øª Ø§Ù„Ø²ÙŠØª -->
        <div class="oil-drop draggable-item" data-type="oil" style="top: 10%; left: 10%; animation-delay: 0s;"></div>
        <div class="oil-drop draggable-item" data-type="oil" style="top: 20%; right: 15%; animation-delay: 1s;"></div>
        <div class="oil-drop draggable-item" data-type="oil" style="top: 60%; left: 20%; animation-delay: 2s;"></div>
        <div class="oil-drop draggable-item" data-type="oil" style="top: 80%; right: 25%; animation-delay: 3s;"></div>
        <div class="oil-drop draggable-item" data-type="oil" style="top: 40%; right: 10%; animation-delay: 4s;"></div>
        
        <!-- ÙÙ„Ø§ØªØ± Ù…ØªØ­Ø±ÙƒØ© -->
        <div class="filter-icon draggable-item" data-type="filter" style="top: 15%; right: 20%; animation-delay: 0.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 35%; left: 15%; animation-delay: 1.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 55%; right: 30%; animation-delay: 2.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 75%; left: 25%; animation-delay: 3.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 25%; left: 5%; animation-delay: 4.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 65%; right: 5%; animation-delay: 5.5s;">ğŸ›¢ï¸</div>
    </div>

    <main class="relative z-10 min-h-full flex items-center justify-center p-4">
        <div class="w-full max-w-4xl">
            <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <header class="text-center mb-8">
                <img src="https://j.top4top.io/p_358488t9h1.png" alt="Portarage Oil Logo" 
                     class="mx-auto max-w-md w-full h-auto rounded-lg shadow-lg"
                     onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
            </header>

            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <div class="glass-effect rounded-2xl p-8 mb-8">
                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 0: Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù (Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù…Ù„Ø©) -->
                <div id="step0" class="step hidden">
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </h2>
                    <div class="text-center">
                        <div class="glass-effect p-6 rounded-lg mb-6 max-w-md mx-auto">
                            <p class="text-gray-300 mb-4">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</p>
                            <p class="text-gray-400 mb-4 text-sm">ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ù…Ù„Ù Excel ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</p>
                            <input type="file" id="excelFileInput" accept=".xlsx,.xls" 
                                   class="hidden" onchange="handleFileUpload(event)">
                            <button onclick="document.getElementById('excelFileInput').click()" 
                                    class="btn-gold text-black font-bold px-6 py-3 rounded-lg text-lg mb-4">
                                ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Excel
                            </button>
                            <div id="fileStatus" class="text-sm text-gray-400"></div>
                        </div>
                        <button onclick="useOfflineData()" 
                                class="bg-gray-600 hover:bg-gray-700 text-white font-bold px-6 py-3 rounded-lg text-lg">
                            Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                        </button>
                    </div>
                </div>

                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1: ÙƒÙ…ÙŠØ© Ø§Ù„Ø²ÙŠØª -->
                <div id="step1" class="step">


                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        ÙƒÙ… Ù„ØªØ± ØªØ­ØªØ§Ø¬ØŸ
                    </h2>
                    <div class="text-center">
                        <input type="number" id="litersInput" min="1" max="50" 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù„ØªØ±Ø§Øª" 
                               class="input-gold text-center text-2xl p-4 rounded-lg w-64 mb-6">
                        <p class="text-gray-400 mb-6 text-lg">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                        <button id="nextBtn" onclick="goToStep2()" 
                                class="btn-gold text-black font-bold px-8 py-4 rounded-lg text-lg opacity-50 cursor-not-allowed" 
                                disabled>
                            Ø§Ù„ØªØ§Ù„ÙŠ
                        </button>
                    </div>
                </div>



                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© -->
                <div id="step2" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step1')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    </h2>
                    <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3" id="viscosityOptions">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </div>
                </div>

                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø²ÙŠØª -->
                <div id="step3" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step2')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø²ÙŠØª
                    </h2>
                    <div class="mb-4">
                        <input type="text" id="oilSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø§Ø±ÙƒØ©..." 
                               class="input-gold w-full p-4 rounded-lg text-lg">
                    </div>
                    <div id="oilOptions" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </div>
                </div>

                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 4: Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                <div id="step4" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step3')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„ÙÙ„ØªØ±
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="selectCarType('german', 12)" 
                                class="btn-gold text-black font-bold p-6 rounded-lg text-lg">
                            Ø£Ù„Ù…Ø§Ù†ÙŠØ© - 12 Ø¯.Ùƒ
                        </button>
                        <button onclick="selectCarType('other', 8)" 
                                class="btn-gold text-black font-bold p-6 rounded-lg text-lg">
                            Ø£Ù…Ø±ÙŠÙƒÙŠØ© / ÙŠØ§Ø¨Ø§Ù†ÙŠØ© / ÙƒÙˆØ±ÙŠØ© - 8 Ø¯.Ùƒ
                        </button>
                        <button onclick="showCustomFilter()" 
                                class="btn-gold text-black font-bold p-6 rounded-lg text-lg">
                            Ø£Ø®Ø±Ù‰
                        </button>
                    </div>
                    
                    <!-- Ø®ÙŠØ§Ø± Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø®ØµØµ -->
                    <div id="customFilterSection" class="hidden mt-6 text-center">
                        <h3 class="text-xl font-bold mb-3 text-yellow-400">Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„ÙÙ„ØªØ±</h3>
                        <div class="flex justify-center items-center gap-3">
                            <input type="number" id="customFilterPrice" min="0" step="0.1" 
                                   placeholder="Ø§Ù„Ø³Ø¹Ø±" 
                                   class="input-gold text-center text-lg p-3 rounded-lg w-32"
                                   onkeypress="handleCustomFilterEnter(event)">
                            <span class="text-lg text-gray-300">Ø¯.Ùƒ</span>
                        </div>
                        <p class="text-gray-400 mt-3 text-sm">Ø§Ø¶ØºØ· Enter Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
                    </div>
                </div>

                <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
                <div id="finalResult" class="step hidden">
                    <div class="mb-6">
                        <button onclick="goBackToOilSelection()" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø²ÙŠØª
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                    </h2>
                    <div class="glass-effect rounded-lg p-6 mb-6">
                        <div id="invoiceDetails" class="space-y-4 text-lg">
                            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                        </div>
                    </div>
                    <div class="text-center space-y-4">
                        <button onclick="copyMessage()" 
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-8 py-4 rounded-lg text-lg transition-colors">
                            Ù†Ø³Ø®
                        </button>

                        <button onclick="resetCalculation()" 
                                class="btn-gold text-black font-bold px-8 py-4 rounded-lg text-lg">
                            Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>



    <script>
        let oilData = [];
        let selectedViscosity = '';
        let selectedOil = null;
        let liters = 0;
        let filterPrice = 0;
        let servicePrice = 15;
        let lastFilterType = ''; // Ø­ÙØ¸ Ø¢Ø®Ø± Ù†ÙˆØ¹ ÙÙ„ØªØ±
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ
        let isDragging = false;
        let currentDragElement = null;
        let dragOffset = { x: 0, y: 0 };

        // ØªØ±Ø¬Ù…Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª
        function translateBrand(brand) {
            switch(brand.toUpperCase()) {
                case "CEPSA GENUINE": return "Ø³ÙŠØ³Ø¨Ø§ Ø§Ø³Ø¨Ø§Ù†ÙŠ ğŸ‡ªğŸ‡¸";
                case "AC DELCO": return "Ø§Ø³ÙŠ Ø¯ÙŠÙ„ÙƒÙˆ Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "MOPAR": return "Ù…ÙˆØ¨Ø§Ø± Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "GAZPROMNEFT": return "ØºØ§Ø²Ø¨Ø±ÙˆÙ… Ù†ÙØ· Ø±ÙˆØ³ÙŠ ğŸ‡·ğŸ‡º";
                case "MOBIL ONE": return "Ù…ÙˆØ¨ÙŠÙ„ ÙˆÙ† Ø§ÙˆØ±Ø¨ÙŠ ğŸ‡ªğŸ‡º";
                case "SHELL HELIX ULTRA": return "Ø´Ù„ Ù‡ÙŠÙ„ÙŠÙƒØ³ Ø£Ù„ØªØ±Ø§ Ø¹Ù…Ø§Ù†ÙŠ ğŸ‡´ğŸ‡²";
                case "RAVENOL": return "Ø±ÙŠÙÙ†ÙˆÙ„ Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "CASTROL": return "ÙƒØ§Ø³ØªØ±ÙˆÙ„ Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠ ğŸ‡¬ğŸ‡§";
                case "WAGNER": return "ÙˆØ§Ø¬Ù†Ø± Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "DUCKHAMS": return "Ø¯Ø§ÙƒÙ‡Ø§Ù… Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠ ğŸ‡¬ğŸ‡§";
                case "BIZOL": return "Ø¨ÙŠØ²ÙˆÙ„ Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "VICTOR": return "ÙÙŠÙƒØªÙˆØ±";
                case "LIQUI MOLY": return "Ù„ÙŠÙƒÙŠ Ù…ÙˆÙ„ÙŠ Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "MOTORCRAFT": return "Ù…ÙˆØªØ±ÙƒØ±Ø§ÙØª Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "G-ENERGY": return "Ø¬ÙŠ-Ø¥Ù†Ø±Ø¬ÙŠ Ø¥ÙŠØ·Ø§Ù„ÙŠ ğŸ‡®ğŸ‡¹";
                case "TOTAL": return "ØªÙˆØªØ§Ù„ ÙØ±Ù†Ø³ÙŠ ğŸ‡«ğŸ‡·";
                case "TOYOTA BLUE": return "ØªÙˆÙŠÙˆØªØ§ Ø¨Ù„Ùˆ ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ";
                case "TOYOTA": return "ØªÙˆÙŠÙˆØªØ§ ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ";
                case "LEXUS": return "Ù„ÙƒØ²Ø³ ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ";
                default: return brand;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets Ø£Ùˆ Ù…Ù„Ù Ù…Ø­Ù„ÙŠ
        async function loadOilData() {
            console.log('Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets...');
            
            try {
                // Ø±Ø§Ø¨Ø· Google Sheets CSV
                const sheetId = '1ax4pCBDTm6Vkq-MZjmmOY1dgwKCUQS5x1GeffkUYOzI';
                const sheetName = 'Stock';
                const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${sheetName}`;
                
                const response = await fetch(csvUrl);
                const csvText = await response.text();
                
                // ØªØ­ÙˆÙŠÙ„ CSV Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ©
                const rows = csvText.split('\n').map(row => {
                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØµÙ ÙˆØ¥Ø²Ø§Ù„Ø© Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³
                    return row.split(',').map(cell => cell.replace(/"/g, '').trim());
                });
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†)
                const headers = rows[0];
                const dataRows = rows.slice(1);
                
                console.log('Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†:', headers);
                
                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù†Ø§Øª
                oilData = dataRows
                    .filter(row => row.length >= 6 && row[0]) // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
                    .map(row => ({
                        brand: row[0] || '',           // Brand
                        type: row[1] || '',            // Type (Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø©)
                        price: parseFloat(row[2]) || 0, // Price
                        liters: parseInt(row[3]) || 0,  // Liters
                        priceLiter: parseFloat(row[4]) || 0, // PriceLiter (Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù…Ù‡)
                        country: row[5] || '',         // Country
                        contAvailable: parseInt(row[6]) || 0 // ContAvailable (Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©)
                    }))
                    .filter(item => item.brand && item.type && item.price > 0 && item.contAvailable > 0); // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© ÙˆØ§Ù„Ù…ØªÙˆÙØ±Ø©
                
                console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets:', oilData.length, 'Ø¹Ù†ØµØ±');
                console.log('Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', oilData.slice(0, 3));
                
                if (oilData.length > 0) {
                    return Promise.resolve();
                } else {
                    throw new Error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø©');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets:', error);
                
                // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
                showStep('step0');
                return Promise.reject('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†');
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ù…Ù„Ù Excel
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const fileStatus = document.getElementById('fileStatus');
            fileStatus.textContent = 'Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù...';
            fileStatus.className = 'text-sm text-yellow-400';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙˆØ±Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ "Stock" Ø£Ùˆ Ø£ÙˆÙ„ ÙˆØ±Ù‚Ø©
                    let sheetName = 'Stock';
                    if (!workbook.Sheets[sheetName]) {
                        sheetName = workbook.SheetNames[0];
                    }
                    
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    const headers = jsonData[0];
                    const dataRows = jsonData.slice(1);
                    
                    console.log('Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ù…Ù† Ø§Ù„Ù…Ù„Ù:', headers);
                    
                    oilData = dataRows
                        .filter(row => row.length >= 6 && row[0]) // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
                        .map(row => ({
                            brand: row[0] || '',           // Brand
                            type: row[1] || '',            // Type (Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø©)
                            price: parseFloat(row[2]) || 0, // Price
                            liters: parseInt(row[3]) || 0,  // Liters
                            priceLiter: parseFloat(row[4]) || 0, // PriceLiter (Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù…Ù‡)
                            country: row[5] || '',         // Country
                            contAvailable: parseInt(row[6]) || 0 // ContAvailable (Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©)
                        }))
                        .filter(item => item.brand && item.type && item.price > 0 && item.contAvailable > 0);
                    
                    console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù:', oilData.length, 'Ø¹Ù†ØµØ±');
                    
                    if (oilData.length > 0) {
                        fileStatus.textContent = `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${oilData.length} Ø¹Ù†ØµØ± Ø¨Ù†Ø¬Ø§Ø­ âœ“`;
                        fileStatus.className = 'text-sm text-green-400';
                        
                        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                        setTimeout(() => {
                            showStep('step1');
                            setupLitersInput();
                        }, 2000);
                    } else {
                        fileStatus.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù âœ—';
                        fileStatus.className = 'text-sm text-red-400';
                    }
                    
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù:', error);
                    fileStatus.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù âœ—';
                    fileStatus.className = 'text-sm text-red-400';
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function useOfflineData() {
            oilData = [
                {brand: "CEPSA GENUINE", type: "5W-30", price: 2, liters: 4, contAvailable: 10},
                {brand: "AC DELCO", type: "5W-30", price: 2.75, liters: 4, contAvailable: 8},
                {brand: "MOBIL ONE", type: "5W-30", price: 4, liters: 4, contAvailable: 5},
                {brand: "SHELL HELIX ULTRA", type: "5W-30", price: 2.063, liters: 4, contAvailable: 12},
                {brand: "CASTROL", type: "5W-30", price: 3.375, liters: 4, contAvailable: 6},
                {brand: "RAVENOL", type: "5W-20", price: 3.75, liters: 4, contAvailable: 7},
                {brand: "LIQUI MOLY", type: "5W-20", price: 3.16, liters: 4, contAvailable: 9},
                {brand: "TOTAL", type: "20W-50", price: 1.75, liters: 4, contAvailable: 15},
                {brand: "TOYOTA", type: "20W-50", price: 1.812, liters: 4, contAvailable: 11}
            ];
            
            console.log('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:', oilData.length, 'Ø¹Ù†ØµØ±');
            showStep('step1');
            setupLitersInput();
        }

        function setupLitersInput() {
            const litersInput = document.getElementById('litersInput');
            const nextBtn = document.getElementById('nextBtn');
            
            if (litersInput && nextBtn) {
                litersInput.oninput = function(e) {
                    liters = parseInt(e.target.value) || 0;
                    if (liters > 0) {
                        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
                        nextBtn.disabled = false;
                        nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        nextBtn.classList.add('hover:scale-105');
                    } else {
                        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø±
                        nextBtn.disabled = true;
                        nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        nextBtn.classList.remove('hover:scale-105');
                    }
                };
                
                // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
                litersInput.onkeypress = function(e) {
                    if (e.key === 'Enter' && liters > 0) {
                        goToStep2();
                    }
                };
            }
        }
        
        function goToStep2() {
            if (liters > 0) {
                showStep('step2');
                displayViscosityOptions();
            }
        }

        function displayViscosityOptions() {
            // ÙÙ„ØªØ±Ø© Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const availableViscosities = [...new Set(
                oilData
                    .filter(item => item.contAvailable >= liters) // ÙÙ‚Ø· Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    .map(item => item.type)
            )];
            
            const container = document.getElementById('viscosityOptions');
            
            if (availableViscosities.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center text-red-400 text-lg">
                        Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${liters} Ù„ØªØ±)
                        <br>
                        <button onclick="showStep('step1')" class="btn-gold text-black font-bold px-6 py-3 rounded-lg text-base mt-4">
                            ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = availableViscosities.map(viscosity => `
                <button onclick="selectViscosity('${viscosity}')" 
                        class="btn-gold text-black font-bold p-3 rounded-lg text-lg hover:scale-105 transition-transform">
                    ${viscosity}
                </button>
            `).join('');
        }

        function selectViscosity(viscosity) {
            selectedViscosity = viscosity;
            showStep('step3');
            displayOilOptions();
        }

        function displayOilOptions() {
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ø²ÙŠÙˆØª Ø­Ø³Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙˆØ§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©
            const filteredOils = oilData.filter(item => 
                item.type === selectedViscosity && 
                item.contAvailable >= liters
            );
            
            const container = document.getElementById('oilOptions');
            
            function renderOils(oils) {
                if (oils.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center text-red-400 text-lg">
                            Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© Ø¨Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${selectedViscosity} ÙˆØ§Ù„ÙƒÙ…ÙŠØ© ${liters} Ù„ØªØ±
                            <br>
                            <button onclick="showStep('step2')" class="btn-gold text-black font-bold px-6 py-3 rounded-lg text-base mt-4">
                                Ø§Ø®ØªÙŠØ§Ø± Ù„Ø²ÙˆØ¬Ø© Ø£Ø®Ø±Ù‰
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²ÙŠÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø§Ù„Ø£Ø±Ø®Øµ Ù„Ù„Ø£ØºÙ„Ù‰
                const sortedOils = oils.sort((a, b) => a.price - b.price);
                
                container.innerHTML = sortedOils.map(oil => `
                    <div onclick="selectOil('${oil.brand}', ${oil.price})" 
                         class="glass-effect p-3 rounded-lg cursor-pointer hover:bg-yellow-900 hover:bg-opacity-20 transition-all border-2 border-transparent hover:border-yellow-500">
                        <h3 class="text-base font-bold text-yellow-400">${translateBrand(oil.brand)}</h3>
                        <p class="text-gray-300 text-xs">Ø§Ù„Ù„Ø²ÙˆØ¬Ø©: ${oil.type}</p>
                        <p class="text-base font-bold text-green-400">${oil.price} Ø¯.Ùƒ / Ù„ØªØ±</p>
                        <p class="text-xs text-blue-400">Ù…ØªÙˆÙØ±: ${oil.contAvailable} Ù„ØªØ±</p>
                    </div>
                `).join('');
            }
            
            renderOils(filteredOils);
            
            // Ø§Ù„Ø¨Ø­Ø«
            document.getElementById('oilSearch').oninput = function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = filteredOils.filter(oil => 
                    oil.brand.toLowerCase().includes(searchTerm) ||
                    translateBrand(oil.brand).toLowerCase().includes(searchTerm)
                );
                renderOils(filtered);
            };
        }



        function selectOil(brandName, price) {
            selectedOil = {name: brandName, price: price};
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙÙ„ØªØ± Ù…Ø­Ø¯Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø§Ù†ØªÙ‚Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©
            if (filterPrice > 0) {
                showStep('finalResult');
                displayFinalResult();
            } else {
                showStep('step4');
            }
        }

        function goBackToOilSelection() {
            showStep('step3');
            displayOilOptions();
        }

        function selectCarType(type, price) {
            filterPrice = price;
            lastFilterType = type; // Ø­ÙØ¸ Ù†ÙˆØ¹ Ø§Ù„ÙÙ„ØªØ±
            showStep('finalResult');
            displayFinalResult();
        }

        function displayFinalResult() {
            const oilTotal = selectedOil.price * liters;
            const grandTotal = oilTotal + filterPrice + servicePrice;
            
            document.getElementById('invoiceDetails').innerHTML = `
                <div class="border-b border-yellow-600 pb-4">
                    <h3 class="text-lg font-bold text-yellow-400 mb-3">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:</h3>
                    <p class="text-base"><span class="text-gray-400">Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø²ÙŠØª:</span> ${translateBrand(selectedOil.name)}</p>
                    <p class="text-base"><span class="text-gray-400">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø©:</span> ${selectedViscosity}</p>
                    <p class="text-base"><span class="text-gray-400">Ø§Ù„ÙƒÙ…ÙŠØ©:</span> ${liters} Ù„ØªØ±</p>
                </div>
                <div class="border-b border-yellow-600 pb-4">
                    <h3 class="text-lg font-bold text-yellow-400 mb-3">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙƒÙ„ÙØ©:</h3>
                    <div class="flex justify-between text-base"><span>Ø§Ù„Ø²ÙŠØª (${liters} Ã— ${selectedOil.price})</span><span>${oilTotal.toFixed(3)} Ø¯.Ùƒ</span></div>
                    <div class="flex justify-between text-base"><span>Ø§Ù„ÙÙ„ØªØ±</span><span>${filterPrice} Ø¯.Ùƒ</span></div>
                    <div class="flex justify-between text-base"><span>Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</span><span>${servicePrice} Ø¯.Ùƒ</span></div>
                </div>
                <div class="text-2xl font-bold text-center">
                    <span class="text-yellow-400">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: </span>
                    <span class="text-green-400">${grandTotal.toFixed(3)} Ø¯.Ùƒ</span>
                </div>
            `;
        }

        function showStep(stepId) {
            document.querySelectorAll('.step').forEach(step => step.classList.add('hidden'));
            document.getElementById(stepId).classList.remove('hidden');
        }

        function copyMessage() {
            
            const oilTotal = selectedOil.price * liters;
            const grandTotal = oilTotal + filterPrice + servicePrice;
            
            const message = `Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(selectedOil.name)} (${liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${selectedViscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(3)} Ø¯Ùƒ`;
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector('button[onclick="copyMessage()"]');
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø® Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(message).then(() => {
                    // Ù†Ø¬Ø­ Ø§Ù„Ù†Ø³Ø®
                    copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    // ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
                    fallbackCopy(message, copyBtn, originalText);
                });
            } else {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
                fallbackCopy(message, copyBtn, originalText);
            }
        }

        // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù†Ø³Ø®
        function fallbackCopy(text, button, originalText) {
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± textarea Ù…Ø¤Ù‚Øª
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    button.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    button.classList.add('bg-green-600');
                    button.classList.remove('bg-blue-600');
                } else {
                    button.textContent = 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® âœ—';
                    button.classList.add('bg-red-600');
                    button.classList.remove('bg-blue-600');
                }
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-600', 'bg-red-600');
                    button.classList.add('bg-blue-600');
                }, 2000);
                
            } catch (err) {
                console.error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù†Ø³Ø®:', err);
                button.textContent = 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® âœ—';
                button.classList.add('bg-red-600');
                button.classList.remove('bg-blue-600');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-red-600');
                    button.classList.add('bg-blue-600');
                }, 2000);
            }
        }

        function showCustomFilter() {
            document.getElementById('customFilterSection').classList.remove('hidden');
        }
        
        function hideCustomFilter() {
            document.getElementById('customFilterSection').classList.add('hidden');
            document.getElementById('customFilterPrice').value = '';
        }
        
        function handleCustomFilterEnter(event) {
            if (event.key === 'Enter') {
                confirmCustomFilter();
            }
        }
        
        function confirmCustomFilter() {
            const customPrice = parseFloat(document.getElementById('customFilterPrice').value);
            if (customPrice >= 0) {
                filterPrice = customPrice;
                lastFilterType = 'custom'; // Ø­ÙØ¸ Ù†ÙˆØ¹ Ø§Ù„ÙÙ„ØªØ±
                showStep('finalResult');
                displayFinalResult();
            } else {
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù…Ø®ØµØµØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† alert
                const input = document.getElementById('customFilterPrice');
                input.style.borderColor = '#ef4444';
                input.placeholder = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­';
                setTimeout(() => {
                    input.style.borderColor = 'rgba(255, 215, 0, 0.5)';
                    input.placeholder = 'Ø§Ù„Ø³Ø¹Ø±';
                }, 2000);
            }
        }

        function resetCalculation() {
            selectedViscosity = '';
            selectedOil = null;
            liters = 0;
            filterPrice = 0;
            // Ù„Ø§ Ù†Ø¹ÙŠØ¯ ØªØ¹ÙŠÙŠÙ† lastFilterType Ù„Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø±
            document.getElementById('oilSearch').value = '';
            document.getElementById('litersInput').value = '';
            document.getElementById('customFilterPrice').value = '';
            hideCustomFilter();
            showStep('step1');
            setupLitersInput();
        }



        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª Ù„Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª
        function setupDraggableElements() {
            const draggableItems = document.querySelectorAll('.draggable-item');
            
            draggableItems.forEach((item, index) => {
                // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³Ø­Ø¨ - Ø§Ù„Ù…Ø§ÙˆØ³ ÙÙ‚Ø·
                item.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    startDrag(e, item);
                });
                
                // Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…ØªØµÙØ­
                item.addEventListener('dragstart', (e) => e.preventDefault());
                
                // Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                item.addEventListener('dblclick', (e) => {
                    e.preventDefault();
                    teleportElement(item);
                });
            });
            
            // ØªØªØ¨Ø¹ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø§ÙˆØ³ Ù„Ù„Ø³Ø­Ø¨ ÙÙ‚Ø·
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    drag(e);
                }
            });
            
            document.addEventListener('mouseup', endDrag);
            
            // Ù…Ù†Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨
            document.addEventListener('selectstart', (e) => {
                if (isDragging) e.preventDefault();
            });
        }
        
        function startDrag(e, element) {
            isDragging = true;
            currentDragElement = element;
            
            // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ Ø§Ù„Ø³Ø­Ø¨
            currentDragElement.classList.add('dragging');
            currentDragElement.style.zIndex = '1000';
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø²Ø§Ø­Ø© Ø¨Ø¯Ù‚Ø©
            const rect = currentDragElement.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            // ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø´Ø±
            document.body.style.cursor = 'grabbing';
        }
        
        function drag(e) {
            if (!isDragging || !currentDragElement) return;
            
            e.preventDefault();
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø¯Ù‚Ø©
            let newX = e.clientX - dragOffset.x;
            let newY = e.clientY - dragOffset.y;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const elementWidth = currentDragElement.offsetWidth || 30;
            const elementHeight = currentDragElement.offsetHeight || 30;
            
            // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø±Ø© Ù…Ø¹ Ø­Ø¯ÙˆØ¯ Ø¨Ø³ÙŠØ·Ø©
            newX = Math.max(-10, Math.min(newX, windowWidth - elementWidth + 10));
            newY = Math.max(-10, Math.min(newY, windowHeight - elementHeight + 10));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙˆØ±Ø§Ù‹
            currentDragElement.style.left = newX + 'px';
            currentDragElement.style.top = newY + 'px';
            currentDragElement.currentX = newX;
            currentDragElement.currentY = newY;
            currentDragElement.style.right = 'auto';
            currentDragElement.style.bottom = 'auto';
        }
        
        function endDrag(e) {
            if (!isDragging || !currentDragElement) return;
            
            isDragging = false;
            
            // Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„Ø§Ø³ Ø§Ù„Ø³Ø­Ø¨
            currentDragElement.classList.remove('dragging');
            currentDragElement.style.zIndex = '100';
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø´ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø´Ø±
            document.body.style.cursor = 'default';
            
            currentDragElement = null;
        }
        
        // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø¹Ù†ØµØ±
        function teleportElement(element) {
            // ØªØ£Ø«ÙŠØ± Ø§Ù†ÙØ¬Ø§Ø±
            element.style.transform = 'scale(2)';
            element.style.opacity = '0.3';
            
            setTimeout(() => {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙˆØ¶Ø¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                const margin = 50;
                const randomX = margin + Math.random() * (window.innerWidth - margin * 2);
                const randomY = margin + Math.random() * (window.innerHeight - margin * 2);
                
                element.style.left = randomX + 'px';
                element.style.top = randomY + 'px';
                element.style.right = 'auto';
                element.style.bottom = 'auto';
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ø´ÙØ§ÙÙŠØ©
                element.style.transform = 'scale(1)';
                element.style.opacity = '1';
                
                // ØªØ£Ø«ÙŠØ± Ø¸Ù‡ÙˆØ±
                element.classList.add('bouncing');
                setTimeout(() => {
                    element.classList.remove('bouncing');
                }, 600);
            }, 200);
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª
        function addInteractiveEffects() {
            // Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© - Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª ØªØ¨Ù‚Ù‰ ÙÙŠ Ù…ÙƒØ§Ù†Ù‡Ø§
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        loadOilData().then(() => {
            setupLitersInput();
            setupDraggableElements();
            addInteractiveEffects();
        }).catch(() => {
            // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
            setupDraggableElements();
            addInteractiveEffects();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9953a99dd35f51c2',t:'MTc2MTU4MzUxMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
